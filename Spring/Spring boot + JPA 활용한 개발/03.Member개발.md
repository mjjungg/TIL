## ê°œë°œ ìˆœì„œ

1. íšŒì› ì—”í‹°í‹° ê°œë°œ â†’ ì´ì „ ê°•ì˜ì—ì„œ ì™„ë£Œ!
2. íšŒì› ë ˆí¬ì§€í† ë¦¬ ê°œë°œ
3. íšŒì› ì„œë¹„ìŠ¤ ê°œë°œ
4. íšŒì› ê¸°ëŠ¥ í…ŒìŠ¤íŠ¸ 

## 2. íšŒì› ë ˆí¬ì§€í† ë¦¬ ê°œë°œ

```java
@Repository
public class MemberRepository{

	@PersistenceContext
	private EntityManager em;
	
	public void save(){...}
	
	...

}
```

- `@PersistenceContext` : ì—”í‹°í‹° ë©”ë‹ˆì € ì£¼ì…

## 3. íšŒì› ì„œë¹„ìŠ¤ ê°œë°œ

```java
@Service
@Transactional(readOnly=true)
public class MemberService{
	
	private final MemberRepository memberRepository;

	// íšŒì›ê°€ì…
	@Transactional 
	public Long join(Member member){
		memberRepository.save(member);
		...
		}

	// ì „ì²´íšŒì› ì¡°íšŒ 
	...

	// íšŒì› ì¡°íšŒ 
	... 
}
```

- `@Transactional` : DB ì ‘ê·¼ì´ ë°œìƒí•˜ëŠ” ì—¬ëŸ¬ ë‹¨ìœ„ì˜ ì‘ì—…ë“¤ì„ ì˜ë¯¸ìˆëŠ” ê·¸ë£¹ìœ¼ë¡œ ë¬¶ì–´ì„œ ì¼ê´„ ì»¤ë°‹ ë˜ëŠ” ì¼ê´„ ë¡¤ë°±í•˜ëŠ” ë§¤ì»¤ë‹ˆì¦˜
    1. readOnly=true : ë°ì´í„°ì˜ ë³€ê²½ì´ ì—†ëŠ” ì½ê¸°, ì¡°íšŒ ë©”ì„œë“œì— ì‚¬ìš© â†’ ì˜ì†ì„± ì»¨í…ìŠ¤íŠ¸ í”ŒëŸ¬ì‹œ xë•Œë¬¸ì— ì•½ê°„ì˜ ì„±ëŠ¥ í–¥ìƒ!

    â‡’ Service ë‚´ë¶€ì˜ ë™ì‘ë“¤ì´ ëŒ€ë¶€ë¶„ ì½ê¸° ê¸°ëŠ¥ì¼ ë•Œ, í´ë˜ìŠ¤ ìœ„ì— readOnly ì„ ì–¸ + ì½ê¸° ê¸°ëŠ¥ì´ ì•„ë‹Œ ë©”ì„œë“œ ìœ„ì— readOnlyì„ ì–¸x í•´ì„œ ì‚¬ìš©! 

    ë°˜ëŒ€ì¸ ê²½ìš° ê±°ê¾¸ë¡œ ì‚¬ìš©! 

- `@Autowired` : ìƒì„±ì ì£¼ì… (ìƒì„±ì í•˜ë‚˜ë©´ ìƒëµ ê°€ëŠ¥)

final í‚¤ì›Œë“œ â†’ ì»´íŒŒì¼ ì‹œì ì— memberRepositoryë¥¼ ì„¤ì •í•˜ì§€ ì•ŠëŠ” ì˜¤ë¥˜ ì²´í¬ ê°€ëŠ¥ 

â• lombok ìœ¼ë¡œ ìƒì„±ì ì£¼ì…

```java
@Repository
@RequiredArgsConstructor
public class MemberService{
	private final MemberRepository memberRepository;
	...
}
```

final í‚¤ì›Œë“œ ë¶™ì€ í•„ë“œë¥¼ íŒŒë¼ë¯¸í„°ë¡œ ë„£ì€ ìƒì„±ì ìë™ ìƒì„±í•´ì¤Œ 

ğŸ¯ ì‹¤ë¬´ì—ì„œëŠ” ì¤‘ë³µ ê²€ì¦ê³¼ ê°™ì€ ê²€ì¦ ë¡œì§ì´ ìˆì–´ë„ ë©€í‹° ìŠ¤ë ˆë“œ ìƒí™© ê³ ë ¤í•˜ì—¬ íšŒì› í…Œì´ë¸”ì˜ íšŒì›ëª… ì»¬ëŸ¼ì— NOT NULL (ìœ ë‹ˆí¬ ì œì•½ ì¡°ê±´) ì¶”ê°€í•˜ëŠ” ê²ƒì´ ì•ˆì „! 

## 4. íšŒì› ê¸°ëŠ¥ í…ŒìŠ¤íŠ¸

### í…ŒìŠ¤íŠ¸ ìš”êµ¬ì‚¬í•­

1. íšŒì›ê°€ì… ì„±ê³µ
2. íšŒì›ê°€ì… ì‹œ ê°™ì€ ì´ë¦„ â†’ ì˜ˆì™¸ ë°œìƒ

```java
@RunWith(SpringRunner.class)
@SpringBootTest
@Transactional
public class MemberServiceTest{
	@Autowired MemberService memberService;
	@Autowired MemberRepository memberRepository;

	@Test
	public void íšŒì›ê°€ì…() throws Exception {
		...
		assertEquals(..., ...);
	}
	
@Test(expected=IllegalStateException.class)
	public void ì¤‘ë³µ_íšŒì›_ì˜ˆì™¸() throws Exception{
		...
		memberService.join(member2); // ì˜ˆì™¸ ë°œìƒ!
		fail("ì—¬ê¸°ê¹Œì§€ ì˜¤ë©´ ì•ˆë˜ê³  ì˜ˆì™¸ ë°œìƒí•´ì•¼ í•¨!");
	}
}
```

- `@RunWith(SpringRunner.class)` : ìŠ¤í”„ë§ê³¼ í…ŒìŠ¤íŠ¸ í†µí•©
- `@SpringBootTest` : ìŠ¤í”„ë§ ë¶€íŠ¸ ë„ìš´ ìƒíƒœì—ì„œ í…ŒìŠ¤íŠ¸(without, @Autowired ë‹¤ ì‹¤íŒ¨)
- `@Transactional` : ê°ê°ì˜ í…ŒìŠ¤íŠ¸ ì‹¤í–‰í•  ë•Œë§ˆë‹¤ íŠ¸ëœì­ì…˜ ì‹œì‘, í…ŒìŠ¤íŠ¸ ëë‚˜ë©´ íŠ¸ëœì­ì…˜ ê°•ì œë¡œ ë¡¤ë°±
